"use client";

import { useState, useMemo } from "react";
import ClubCard from "./ClubCard";
import AuthSidebar from "./AuthSidebar";

export default function ClubSearch({ initialClubs = [] }) {
  const [search, setSearch] = useState("");
  const [country, setCountry] = useState("");
  const [city, setCity] = useState("");

  const filteredClubs = useMemo(() => {
    return initialClubs.filter((club) => {
      const matchText =
        club.name.toLowerCase().includes(search.toLowerCase()) ||
        club.city.toLowerCase().includes(search.toLowerCase()) ||
        club.country.toLowerCase().includes(search.toLowerCase());
      const matchCountry = country ? club.country === country : true;
      const matchCity = city ? club.city === city : true;
      return matchText && matchCountry && matchCity;
    });
  }, [search, country, city, initialClubs]);

  const countries = Array.from(new Set(initialClubs.map((c) => c.country))).sort();
  const cities = Array.from(new Set(initialClubs.map((c) => c.city))).sort();

  // Dynamische Statistik
  const filteredCountryCount = useMemo(() => {
    return new Set(filteredClubs.map((c) => c.country)).size;
  }, [filteredClubs]);

  return (
    <div style={{ display: "flex", gap: "24px" }}>
      <AuthSidebar />
      <div style={{ flex: 1 }}>
        {/* Filterleiste */}
        <div className="filter-container">
          <input
            type="text"
            placeholder="Suche..."
            value={search}
            onChange={(e) => setSearch(e.target.value)}
          />
          <select value={country} onChange={(e) => setCountry(e.target.value)}>
            <option value="">Alle Länder</option>
            {countries.map((c) => (
              <option key={c} value={c}>{c}</option>
            ))}
          </select>
          <select value={city} onChange={(e) => setCity(e.target.value)}>
            <option value="">Alle Städte</option>
            {cities.map((c) => (
              <option key={c} value={c}>{c}</option>
            ))}
          </select>
        </div>

        {/* Überschrift mit dynamischer Statistik */}
        <h2 style={{ textAlign: "center", fontSize: "1.2rem", marginBottom: "24px" }}>
          (Suchergebnis: Anzahl der Golfclubs: {filteredClubs.length}; Anzahl der Länder: {filteredCountryCount})
        </h2>

        {/* Clubs Grid */}
        <div className="clubs-grid">
          {filteredClubs.map((club) => (
            <ClubCard key={club.id} club={club} />
          ))}
        </div>
      </div>
    </div>
  );
}
